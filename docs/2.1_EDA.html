<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hands-on Workshop on Time Series Analysis and Forecasting using R: IPHACON 2024 - Exploratory Time Series Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href=".//images/spatial_hex.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/spatial_hex.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Hands-on Workshop on Time Series Analysis and Forecasting using R: IPHACON 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./1_intro.html" rel="" target="">
 <span class="menu-text">Introduction to time series analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./2_EDA.html" rel="" target="">
 <span class="menu-text">Handling Time series datasets</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./2.1_EDA.html" rel="" target="" aria-current="page">
 <span class="menu-text">Exploratory Time Series Analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./4_Model.html" rel="" target="">
 <span class="menu-text">Workflow: Modeltime</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src=".\images/spatial_hex.png" class="img-fluid" style="width:65.0%"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#concept-of-stationarity-and-transformations." id="toc-concept-of-stationarity-and-transformations." class="nav-link active" data-scroll-target="#concept-of-stationarity-and-transformations."><span class="header-section-number">1</span> Concept of stationarity and transformations.</a></li>
  <li><a href="#time-series-components." id="toc-time-series-components." class="nav-link" data-scroll-target="#time-series-components."><span class="header-section-number">2</span> Time series components.</a></li>
  <li><a href="#visualizations." id="toc-visualizations." class="nav-link" data-scroll-target="#visualizations."><span class="header-section-number">3</span> Visualizations.</a>
  <ul>
  <li><a href="#time-plots" id="toc-time-plots" class="nav-link" data-scroll-target="#time-plots"><span class="header-section-number">3.1</span> Time plots</a></li>
  <li><a href="#seasonal-plots." id="toc-seasonal-plots." class="nav-link" data-scroll-target="#seasonal-plots."><span class="header-section-number">3.2</span> Seasonal plots.</a></li>
  <li><a href="#seasonal-subseries-plot." id="toc-seasonal-subseries-plot." class="nav-link" data-scroll-target="#seasonal-subseries-plot."><span class="header-section-number">3.3</span> Seasonal subseries plot.</a></li>
  </ul></li>
  <li><a href="#time-series-features." id="toc-time-series-features." class="nav-link" data-scroll-target="#time-series-features."><span class="header-section-number">4</span> Time series features.</a>
  <ul>
  <li><a href="#autocorrelation-function-acf" id="toc-autocorrelation-function-acf" class="nav-link" data-scroll-target="#autocorrelation-function-acf"><span class="header-section-number">4.1</span> Autocorrelation function (ACF)</a></li>
  <li><a href="#additional-acf-features" id="toc-additional-acf-features" class="nav-link" data-scroll-target="#additional-acf-features"><span class="header-section-number">4.2</span> Additional ACF features</a></li>
  </ul></li>
  <li><a href="#time-series-decomposition" id="toc-time-series-decomposition" class="nav-link" data-scroll-target="#time-series-decomposition"><span class="header-section-number">5</span> Time series decomposition</a>
  <ul>
  <li><a href="#additional-stl-features" id="toc-additional-stl-features" class="nav-link" data-scroll-target="#additional-stl-features"><span class="header-section-number">5.1</span> Additional STL features</a></li>
  </ul></li>
  <li><a href="#moving-averages." id="toc-moving-averages." class="nav-link" data-scroll-target="#moving-averages."><span class="header-section-number">6</span> Moving averages.</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploratory Time Series Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>
<p>Welcome to the world of Time Series Analysis and forecasting!!</p>
<section id="concept-of-stationarity-and-transformations." class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="concept-of-stationarity-and-transformations."><span class="header-section-number">1</span> Concept of stationarity and transformations.</h2>
<p>It is important to understand that ARIMA models are based on assumption that the time series data is stationary in nature. A time series is said to be stationary when the mean value of each time component is similar (i.e no trend or seasonality). In other words, A stationary time series is one whose statistical properties do not depend on the time at which the series is observed. However, often that is not the case. If the data shows variation that increases or decreases with the level of the series, then a transformation can be useful. For example, a logarithmic transformation is often useful to make a series stationary. Another useful family of transformations, that includes both logarithms and power transformations, is the family of Box-Cox transformations. Also, differencing of the order one or two is a commonly used approach for making time series stationary. We shall be discussing this topic further as we progress in the workshop for a better understanding.</p>
</section>
<section id="time-series-components." class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="time-series-components."><span class="header-section-number">2</span> Time series components.</h2>
<p>A time series data is often described in terms of trend, seasonality and cyclicity.</p>
<ul>
<li><p><strong>Trend</strong>. A trend is said to be present when there is a long-term increase or decrease in the data. This change does not always have to be linear.</p></li>
<li><p><strong>Seasonality</strong>. A seasonal pattern occurs when a time series is affected by seasonal factors such as the time of the year or the day of the week. Seasonality is always of a fixed and known period.</p></li>
<li><p><strong>Cyclicity</strong>. A cycle occurs when the data exhibit rises and falls that are not of a fixed frequency.</p></li>
</ul>
</section>
<section id="visualizations." class="level2 page-columns page-full" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="visualizations."><span class="header-section-number">3</span> Visualizations.</h2>
<section id="time-plots" class="level3 page-columns page-full" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="time-plots"><span class="header-section-number">3.1</span> Time plots</h3>
<p>What kind of trend, seasonality and cyclicity do you observe in the following visualizations?</p>

<div class="no-row-height column-margin column-container"><div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-2_a603fcf9d3628faf7ec34aa60fa8bc45">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating tsibble objects</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df_aqi <span class="ot">&lt;-</span> df_aqi <span class="sc">|&gt;</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `Sample Date` as index variable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df_rta <span class="ot">&lt;-</span> df_rta <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df_disaster <span class="ot">&lt;-</span> df_disaster <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df_mmr <span class="ot">&lt;-</span> df_mmr <span class="sc">|&gt;</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">dmy</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="st">"01-01-"</span>, Year)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `Year` as index variable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df_campylo <span class="ot">&lt;-</span> df_campylo <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearweek</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_750 <span class="ot">&lt;-</span> df_750 <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">yearmonth</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using `date` as index variable.</code></pre>
</div>
</div></div><div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_aqi <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_rta <span class="sc">|&gt;</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>df_disaster <span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>df_mmr <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>df_campylo <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>df_750 <span class="sc">|&gt;</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-subfigures" class="cell quarto-layout-panel" data-hash="2.1_EDA_cache/html/fig-subfigures_1040c7c9a9edfa51a3ce9261c20106a5">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-1.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(a) AQI</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-2.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(b) RTA</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-3.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(c) Earthquakes</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-4.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(d) MMR</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-5.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(e) Campylobacter</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-6.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(f) M750</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-subfigures-7" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-subfigures-7.png" class="img-fluid figure-img" data-ref-parent="fig-subfigures" width="672"></p>
<figcaption class="figure-caption">(g) Diabetes drug sales</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Visualizations for Trend, seasonality and cyclicity</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="seasonal-plots." class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="seasonal-plots."><span class="header-section-number">3.2</span> Seasonal plots.</h3>
<p>A seasonal plot is similar to a time plot except that the data are plotted against the individual “seasons” in which the data were observed.A seasonal plot allows the underlying seasonal pattern to be seen more clearly, and is especially useful in identifying years in which the pattern changes.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-4_45c7c656de6dd88412ef4c84c07eaf5e">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_season</span>(TotalC, <span class="at">labels =</span> <span class="st">"both"</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"$ (millions)"</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Seasonal plot: Antidiabetic drug sales"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-5_b92b59452ed50691c900ea412e047146">
<div class="cell-output-display">
<p><img src="2.1_EDA_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="seasonal-subseries-plot." class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="seasonal-subseries-plot."><span class="header-section-number">3.3</span> Seasonal subseries plot.</h3>
<p>Seasonal subseries plot is an alternative plot that emphasises the seasonal patterns is where the data for each season are collected together in separate mini time plots. The blue horizontal lines indicate the means for each month. This form of plot enables the underlying seasonal pattern to be seen clearly, and also shows the changes in seasonality over time. It is especially useful in identifying changes within particular seasons.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-6_3f6625ca877b10ad5eb7fe40b849befc">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gg_subseries</span>(TotalC) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"$ (millions)"</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Antidiabetic drug sales"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-7_862937cd5f2e179b62d94d444c257172">
<div class="cell-output-display">
<p><img src="2.1_EDA_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="time-series-features." class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="time-series-features."><span class="header-section-number">4</span> Time series features.</h2>
<section id="autocorrelation-function-acf" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="autocorrelation-function-acf"><span class="header-section-number">4.1</span> Autocorrelation function (ACF)</h3>
<p>Just as correlation measures the extent of a linear relationship between two variables, autocorrelation measures the linear relationship between lagged values of a time series. In a time series, the autocorrelation coefficients between varied lags make up the autocorrelation function or ACF.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-8_61de6777fb041898d249a6970b01e22d">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_aqi <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(<span class="st">`</span><span class="at">PM10 (µg/m³)</span><span class="st">`</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">lag_max =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-9_c7c9db4dc92dee4d4eed7fd9900b4484">
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 5 x 2 [1M]
       lag   acf
  &lt;cf_lag&gt; &lt;dbl&gt;
1       1M 0.447
2       2M 0.116
3       3M 0.247
4       4M 0.244
5       5M 0.150</code></pre>
</div>
</div>
</div>
</div>
<p>The same can also be visualized through ACF plot for better understanding.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_aqi <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(<span class="st">`</span><span class="at">PM10 (µg/m³)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>df_rta <span class="sc">|&gt;</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(accidents) <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>df_disaster <span class="sc">|&gt;</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(deaths_earthquakes) <span class="sc">|&gt;</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>df_campylo <span class="sc">|&gt;</span> </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(case) <span class="sc">|&gt;</span> </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>df_750 <span class="sc">|&gt;</span> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(value) <span class="sc">|&gt;</span> </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span> </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ACF</span>(TotalC) <span class="sc">|&gt;</span> </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-acf" class="cell quarto-layout-panel" data-hash="2.1_EDA_cache/html/fig-acf_5c4ccf936e509d93ce3ee4d835c8d760">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-acf-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-acf-1.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(a) AQI</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-acf-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-acf-2.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(b) RTA</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-acf-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-acf-3.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(c) Earthquakes</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-acf-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-acf-4.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(d) MMR</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-acf-5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-acf-5.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(e) Campylobacter</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 33.3%;justify-content: center;">
<div id="fig-acf-6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-acf-6.png" class="img-fluid figure-img" data-ref-parent="fig-acf" width="672"></p>
<figcaption class="figure-caption">(f) M750</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Visualizations for Trend, seasonality and cyclicity</figcaption><p></p>
</figure>
</div>
</div>
</section>
<section id="additional-acf-features" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="additional-acf-features"><span class="header-section-number">4.2</span> Additional ACF features</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>The <code>feat_acf()</code> function computes a selection of the autocorrelations as under:</p>
<ul>
<li>The first autocorrelation coefficient from the original data; the sum of squares of the first ten autocorrelation coefficients from the original data;</li>
<li>The first autocorrelation coefficient from the differenced data;</li>
<li>The sum of squares of the first ten autocorrelation coefficients from the differenced data;</li>
<li>The first autocorrelation coefficient from the twice differenced data;</li>
<li>The sum of squares of the first ten autocorrelation coefficients from the twice differenced data;</li>
<li>For seasonal data, the autocorrelation coefficient at the first seasonal lag is also returned.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-11_64e7e3d88a0139e91b1693a8aebde24a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_aqi <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(<span class="st">`</span><span class="at">PM10 (µg/m³)</span><span class="st">`</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           feat_acf)<span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  name          value
  &lt;chr&gt;         &lt;dbl&gt;
1 acf1         0.447 
2 acf10        0.395 
3 diff1_acf1  -0.121 
4 diff1_acf10  0.540 
5 diff2_acf1  -0.318 
6 diff2_acf10  0.599 
7 season_acf1 -0.0140</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="time-series-decomposition" class="level2 page-columns page-full" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="time-series-decomposition"><span class="header-section-number">5</span> Time series decomposition</h2>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Decomposition methods
</div>
</div>
<div class="callout-body-container callout-body">
<p>The additive decomposition is the most appropriate if the magnitude of the seasonal fluctuations, or the variation around the trend-cycle, does not vary with the level of the time series. When the variation in the seasonal pattern, or the variation around the trend-cycle, appears to be proportional to the level of the time series, then a multiplicative decomposition is more appropriate.</p>
</div>
</div>
</div></div><p>Time series data is decomposed into trend, seasonality and remainder components based on additive or multiplicative decomposition methods. If we assume an additive decomposition, then we can write <span class="math inline">\(y_t = S_t + T_t + R_t\)</span> where <span class="math inline">\(y_t\)</span> is the data, <span class="math inline">\(S_t\)</span> is the seasonal component, <span class="math inline">\(T_t\)</span> is the trend-cycle component, and <span class="math inline">\(R_t\)</span> is the remainder component, all at period <span class="math inline">\(t\)</span>. Alternatively, a multiplicative decomposition would be written as <span class="math inline">\(y_t = S_t * T_t * R_t\)</span>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-12_a06627ff62182218ac027a85ab5e42a2">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(TotalC)) <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A dable: 204 x 7 [1M]
# Key:     .model [1]
# :        TotalC = trend + season_year + remainder
   .model    Month  TotalC    trend season_year remainder season_adjust
   &lt;chr&gt;     &lt;mth&gt;   &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
 1 stl    1991 Jul 3526591 3270635.    -127065.   383021.      3653656.
 2 stl    1991 Aug 3180891 3310236.    -116422.   -12923.      3297313.
 3 stl    1991 Sep 3252221 3349837.     -87179.   -10437.      3339400.
 4 stl    1991 Oct 3611003 3389438.     134369.    87196.      3476634.
 5 stl    1991 Nov 3565869 3429518.     254173.  -117822.      3311696.
 6 stl    1991 Dec 4306371 3469598.    1640931.  -804158.      2665440.
 7 stl    1992 Jan 5088335 3509677.    1811795.  -233137.      3276540.
 8 stl    1992 Feb 2814520 3549836.   -1143268.   407952.      3957788.
 9 stl    1992 Mar 2985811 3589994.    -704096.    99913.      3689907.
10 stl    1992 Apr 3204780 3630153.    -727385.   302012.      3932165.
# ℹ 194 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-13_f8795bc064d47197c1faecae03a13c6c">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model</span>(<span class="at">stl =</span> <span class="fu">STL</span>(TotalC)) <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">components</span>()<span class="sc">|&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2.1_EDA_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<section id="additional-stl-features" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="additional-stl-features"><span class="header-section-number">5.1</span> Additional STL features</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>A time series decomposition can be used to measure the strength of trend and seasonality in a time series. The <code>feat_stl()</code> function returns several more features described as under:</p>
<ul>
<li><code>seasonal_peak_year</code> indicates the timing of the peaks — which month or quarter contains the largest seasonal component. - <code>seasonal_trough_year</code> indicates the timing of the troughs — which month or quarter contains the smallest seasonal component.</li>
<li><code>spikiness</code> measures the prevalence of spikes in the remainder component<br>
</li>
<li><code>linearity</code> measures the linearity of the trend component of the STL decomposition. It is based on the coefficient of a linear regression applied to the trend component.</li>
<li><code>curvature</code> measures the curvature of the trend component of the STL decomposition. It is based on the coefficient from a quadratic regression applied to the trend component.</li>
<li><code>stl_e_acf1</code> is the first autocorrelation coefficient of the remainder series.</li>
<li><code>stl_e_acf10</code> is the sum of squares of the first ten autocorrelation coefficients of the remainder series.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-14_b67e278d22b87da90ee147df971e58ed">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_diab <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">features</span>(TotalC, </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           feat_stl) <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  name                       value
  &lt;chr&gt;                      &lt;dbl&gt;
1 trend_strength          9.88e- 1
2 seasonal_strength_year  8.77e- 1
3 seasonal_peak_year      7   e+ 0
4 seasonal_trough_year    8   e+ 0
5 spikiness               2.99e+19
6 linearity               7.88e+ 7
7 curvature               1.81e+ 7
8 stl_e_acf1             -2.22e- 1
9 stl_e_acf10             1.48e- 1</code></pre>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="moving-averages." class="level2 page-columns page-full" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="moving-averages."><span class="header-section-number">6</span> Moving averages.</h2>

<div class="no-row-height column-margin column-container"><div class="">
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Simple moving averages such as these are usually of an odd order. the middle observation, and <span class="math inline">\(k\)</span> observations on either side, are averaged. In case of even, moving average to a moving average is applied to make an even-order moving average symmetric. Also, weighted MAs are used to yield a smoother estimate of the trend-cycle.</p>
</div>
</div>
</div></div><p>The classical method of time series decomposition originated in the 1920s and was widely used until the 1950s. It still forms the basis of many time series decomposition methods, so it is important to understand how it works. The first step in a classical decomposition is to use a moving average method to estimate the trend-cycle. A moving average of order <span class="math inline">\(m\)</span> can be written as</p>
<p><span class="math inline">\(T_t = 1/m \sum_{j = -k}^k y_{t+j}\)</span> where <span class="math inline">\(m = 2k+1\)</span></p>
<p>The estimate of the trend-cycle at time <span class="math inline">\(t\)</span> is obtained by averaging values of the time series within <span class="math inline">\(k\)</span> periods of <span class="math inline">\(t\)</span> . Observations that are nearby in time are also likely to be close in value. Therefore, the average eliminates some of the randomness in the data, leaving a smooth trend-cycle component. We call this an <span class="math inline">\(m-MA\)</span>, meaning a moving average of order <span class="math inline">\(m\)</span>.</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-hash="2.1_EDA_cache/html/unnamed-chunk-15_40879bdb6d475ee0b120be660841ffa0">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>diab_ma5 <span class="ot">&lt;-</span> df_diab <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span> <span class="ot">=</span> slider<span class="sc">::</span><span class="fu">slide_dbl</span>(TotalC, mean,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.before =</span> <span class="dv">2</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">.after =</span> <span class="dv">2</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">.complete =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To see what the trend-cycle estimate looks like, we plot it along with the original data</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think over!
</div>
</div>
<div class="callout-body-container callout-body">
<p>How will you calculate moving averages for 3-MA, 7-MA, and 9-MA?</p>
</div>
</div>
</div><div class="column" style="width:50%;">
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>diab_ma3 <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(TotalC) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">3-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"red"</span>) </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>diab_ma5 <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(TotalC) <span class="sc">+</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">5-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"red"</span>) </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>diab_ma7 <span class="sc">|&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(TotalC) <span class="sc">+</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">7-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"red"</span>) </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>diab_ma9 <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(TotalC) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">9-MA</span><span class="st">`</span>), <span class="at">colour =</span> <span class="st">"red"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-ma" class="cell quarto-layout-panel" data-hash="2.1_EDA_cache/html/fig-ma_4b70e06512056c59c72cdfa132c2b790">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ma-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-ma-1.png" class="img-fluid figure-img" data-ref-parent="fig-ma" width="672"></p>
<figcaption class="figure-caption">(a) 3-MA</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ma-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-ma-2.png" class="img-fluid figure-img" data-ref-parent="fig-ma" width="672"></p>
<figcaption class="figure-caption">(b) 5-MA</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ma-3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-ma-3.png" class="img-fluid figure-img" data-ref-parent="fig-ma" width="672"></p>
<figcaption class="figure-caption">(c) 7-MA</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-ma-4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="2.1_EDA_files/figure-html/fig-ma-4.png" class="img-fluid figure-img" data-ref-parent="fig-ma" width="672"></p>
<figcaption class="figure-caption">(d) 9-MA</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Moving averages</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>